import streamlit as st
import requests

st.title("Website Vulnerability Scanner")

url = st.text_input("Enter Website URL")

# ==============================
# SAFE WEBSITE REQUEST FUNCTION
# ==============================
def fetch_url(target_url):
    try:
        headers = {
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64)"
        }

        response = requests.get(
            target_url,
            headers=headers,
            timeout=10,
            allow_redirects=True
        )

        return response.text.lower()

    except requests.exceptions.RequestException:
        return None


# ==============================
# SQL INJECTION CHECK
# ==============================
def check_sql_injection(target_url):
    payload = "' OR '1'='1"
    test_url = target_url + payload

    html = fetch_url(test_url)

    if html is None:
        return "Error connecting to URL"

    sql_errors = [
        "sql syntax",
        "mysql",
        "syntax error",
        "unclosed quotation",
        "database error"
    ]

    for err in sql_errors:
        if err in html:
            return "SQL Injection vulnerability detected"

    return "No SQL Injection detected"


# ==============================
# XSS CHECK
# ==============================
def check_xss(target_url):
    payload = "<script>alert(1)</script>"
    test_url = target_url + payload

    html = fetch_url(test_url)

    if html is None:
        return "Error connecting to URL"

    if payload.lower() in html:
        return "XSS vulnerability detected"

    return "No XSS detected"


# ==============================
# BUTTON ACTION
# ==============================
if st.button("Scan Website"):

    if not url:
        st.warning("Enter URL first")
    else:
        st.subheader("SQL Injection Result")
        st.write(check_sql_injection(url))

        st.subheader("XSS Result")
        st.write(check_xss(url))
